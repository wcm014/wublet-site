<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wublet Link Index</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    max-width: 700px;
    margin: 40px auto;
    padding: 0 20px;
  }
  h1 { margin-bottom: 0.5em; }
  .item {
    padding: 12px 0;
    border-bottom: 1px solid #ddd;
  }
  .date {
    color: #666;
    font-size: 0.9em;
  }
</style>
</head>
<body>

<h1>Wublet Links</h1>
<div id="items">Loadingâ€¦</div>

<script>
const LINKS_DIR = '/links/';

// Fetch directory listing
async function listMarkdownFiles() {
  const res = await fetch(LINKS_DIR);
  const html = await res.text();

  const parser = new DOMParser();
  const doc = parser.parseFromString(html, 'text/html');

  return [...doc.querySelectorAll('a')]
    .map(a => a.getAttribute('href'))
    .filter(href => href && href.endsWith('.md'));
}

// Parse a single .md file
async function loadMarkdownFile(filename) {
  const res = await fetch(LINKS_DIR + filename);
  const text = await res.text();

  const title = (text.match(/title:\s*(.*)/) || [,'(untitled)'])[1].trim();
  const dateStr = (text.match(/date:\s*(.*)/) || [,'1970-01-01'])[1].trim();
  const date = new Date(dateStr);
  const lines = text.trim().split('\n');
  const url = lines[lines.length - 1].trim();

  return { title, date, url };
}

// Render the list
function render(items) {
  const container = document.getElementById('items');
  container.innerHTML = '';

  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'item';

    div.innerHTML = `
      <a href="${item.url}" target="_blank">${item.title}</a><br>
      <span class="date">${item.date.toLocaleString()}</span>
    `;

    container.appendChild(div);
  });
}

// Main
(async function () {
  try {
    const files = await listMarkdownFiles();
    const items = await Promise.all(files.map(loadMarkdownFile));

    items.sort((a, b) => b.date - a.date);

    render(items);
  } catch (err) {
    console.error(err);
    document.getElementById('items').innerText = 'Error loading links.';
  }
})();
</script>

</body>
</html>
